<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>RL demo</title>

<script src="test/js/jquery-1.8.3.min.js"></script>
<!--<script src="js/vis.js"></script>
<script src="js/util.js"></script>
<script src="js/image-helpers.js"></script>
<script src="js/pica.js"></script>-->



<script src="/transpiler/system.js"></script>
<script>
SystemJS.config({
    map: {
      'plugin-traceur': 'transpiler/plugin-traceur.js',
      'traceur': 'transpiler/traceur.js',
      'traceur-runtime': 'transpiler/traceur-runtime.js'
    },
    meta: {
      'traceur': {
        format: 'global',
        exports: 'traceur',
        scriptLoad: false
      },
      'traceur-runtime': {
        format: 'global',
        exports: '$traceurRuntime'
      }
    },
    transpiler: 'plugin-traceur',
    transpilerRuntime: false,
    baseURL: '/'
})
</script>



<script type="text/javascript">

var create_world;
var w; // global world object
var current_interval_id;
var skipdraw = false;
var canvas;


SystemJS.import('rl_demo.js').then(function(rldemo) {
    create_world = rldemo.create_world;
});


// Tick the world
function tick() {
    w.tick();
    if(skipdraw) {
        for (var i=0;i<100;i++) w.tick();
    }
    // if(!skipdraw || w.clock % 50 === 0) {
    //     w.draw(canvas);
    // }
    w.draw(canvas);
}

var simspeed = 2;
function goveryfast() {
    window.clearInterval(current_interval_id);
    current_interval_id = setInterval(tick, 0);
    skipdraw = true;
    simspeed = 3;
}
function gofast() {
    window.clearInterval(current_interval_id);
    current_interval_id = setInterval(tick, 0);
    skipdraw = false;
    simspeed = 2;
}
function gonormal() {
    window.clearInterval(current_interval_id);
    current_interval_id = setInterval(tick, 30);
    skipdraw = false;
    simspeed = 1;
}
function goslow() {
    window.clearInterval(current_interval_id);
    current_interval_id = setInterval(tick, 200);
    skipdraw = false;
    simspeed = 0;
}

function savenet() {
    var j = w.agents[0].brain.value_net.toJSON();
    var t = JSON.stringify(j);
    document.getElementById('tt').value = t;
}

function loadnet() {
    var t = document.getElementById('tt').value;
    var j = JSON.parse(t);
    w.agents.brain.value_net.fromJSON(j);
    stoplearn(); // also stop learning
    gonormal();
}

function startlearn() {
    w.agent.brain.learning = true;
}
function stoplearn() {
    w.agent.brain.learning = false;
}

function reload() {
    w.agent = new Agent(); // this should simply work. I think... ;\
    reward_graph = new cnnvis.Graph(); // reinit
}

function start() {
    while(!create_world) {
        setTimeout(start, 500);
        return;
    }
    canvas = document.getElementById("canvas");
    w = create_world(canvas.width, canvas.height);
    stoplearn();
    // goslow();
    // startlearn();
    gofast();

    // $.getJSON("RL/helper/saving.json", function(json) {
    //     w.agent.brain.value_net.fromJSON(json);
    //     stoplearn();
    //     goveryfast();
    // }); 

}

function loadfile() {
    w.agent.brain.value_net.fromJSON(j);
    stoplearn(); // also stop learning
    gonormal();
}
  
start();
 
</script>

</head>
<body>
  <canvas id="canvas" width="700" height="500"></canvas>

</body>
</html>


